<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Exam Portal</title>
</head>
<body>
  <h1>Exam Portal</h1>

  <div id="questions"></div>
  <br>
  <input type="text" id="studentName" placeholder="Your Name">
  <input type="text" id="studentID" placeholder="Student ID">
  <br><br>
  <button onclick="submitAnswers()">Submit Answers</button>
  <p id="result"></p>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzlGHcP9wDP4I9ifmpUuFxuzwl_FqnbuPaok4-7NG17i6e6g4Xy55B5cP5g7ahW80jcKg/exec"; // Ganti dengan URL /exec

    let questionData = [];

    async function loadQuestions() {
      const res = await fetch(`${WEBAPP_URL}?action=getQuestions`);
      questionData = await res.json();

      const container = document.getElementById("questions");
      container.innerHTML = "";

      questionData.forEach((q, i) => {
        const div = document.createElement("div");
        div.innerHTML = `<p>${i+1}. ${q.question} (Max: ${q.maxMark})</p>
                         <input type="text" id="ans${i}" placeholder="Your answer">`;
        container.appendChild(div);
      });
    }

    async function submitAnswers() {
      const name = document.getElementById("studentName").value.trim();
      const id = document.getElementById("studentID").value.trim();
      if (!name || !id) {
        alert("Please enter name and ID");
        return;
      }

      const answers = questionData.map((_, i) => document.getElementById(`ans${i}`).value);

      try {
        const res = await fetch(WEBAPP_URL, {
          method: "POST",
          body: JSON.stringify({ action: "checkAnswersAndSave", name, id, answers }),
          headers: { "Content-Type": "application/json" }
        });
        const data = await res.json();
        document.getElementById("result").innerText = data.message;
      } catch (err) {
        document.getElementById("result").innerText = "Error submitting answers: " + err;
      }
    }

    window.onload = loadQuestions;
  </script>
</body>
</html>
