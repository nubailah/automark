<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auto Marking System</title>
<style>
body { font-family: Arial; margin: 20px; background: #f8f9fa; }
.card { background:white; padding:20px; border-radius:8px; max-width:800px; margin:auto; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
h2 { text-align:center; }
.input-group { margin-bottom:10px; }
label { font-weight:bold; }
input[type=text] { width:100%; padding:8px; border-radius:4px; border:1px solid #ccc; }
.question-row { margin-bottom:10px; }
.question { font-weight:bold; margin-bottom:5px; }
.answer input { width:100%; padding:6px; border:1px solid #ccc; border-radius:4px; }
button { background:#007bff; color:white; padding:10px 15px; border:none; border-radius:4px; cursor:pointer; }
button:disabled { background:#ccc; cursor:not-allowed; }
#loading { color:red; font-weight:bold; text-align:center; margin:10px 0; }
a.pdf-link { color:#007bff; font-weight:bold; text-decoration:none; }
</style>
</head>
<body>
<div class="card">
<h2>Auto Marking System</h2>

<div id="pdfLinkContainer" style="text-align:center;"></div>

<div class="input-group">
<label>Student Name:</label>
<input type="text" id="studentName">
</div>
<div class="input-group">
<label>Student ID:</label>
<input type="text" id="studentId">
</div>

<div id="questions"></div>

<button id="openBtn" onclick="openExam()">Open Exam</button>
<button id="submitBtn" onclick="submitAnswers()" disabled>Submit Answers</button>

<div id="loading"></div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzlGHcP9wDP4I9ifmpUuFxuzwl_FqnbuPaok4-7NG17i6e6g4Xy55B5cP5g7ahW80jcKg/exec"; // Ganti dengan URL Web App

async function openExam(){
  document.getElementById('loading').innerText = "Loading exam...";
  document.getElementById('openBtn').disabled = true;

  await loadPdfLink();
  await loadQuestions();

  document.getElementById('submitBtn').disabled = false;
  document.getElementById('loading').innerText = "";
}

async function loadPdfLink(){
  try{
    const res = await fetch(WEBAPP_URL + "?action=getPdfLink");
    const data = await res.json();
    const container = document.getElementById('pdfLinkContainer');
    if(data.link) container.innerHTML = `<a href="${data.link}" target="_blank" class="pdf-link">Open PDF</a>`;
  }catch(err){ console.error(err); }
}

async function loadQuestions(){
  try{
    const res = await fetch(WEBAPP_URL + "?action=getQuestions");
    const questions = await res.json();
    const container = document.getElementById('questions');
    container.innerHTML = '';
    questions.forEach((q,i)=>{
      const row = document.createElement('div');
      row.className = 'question-row';
      row.innerHTML = `
        <div class="question">${q.question}</div>
        <div class="answer"><input type="text" id="answer_${i}" placeholder="Your answer"></div>
      `;
      container.appendChild(row);
    });
  }catch(err){ console.error(err); }
}

async function submitAnswers(){
  const name = document.getElementById('studentName').value.trim();
  const id = document.getElementById('studentId').value.trim();
  if(!name || !id){ alert("Enter Name and ID"); return; }

  const inputs = document.querySelectorAll('[id^="answer_"]');
  const answers = Array.from(inputs).map(input=>input.value.trim());

  document.getElementById('submitBtn').disabled = true;
  document.getElementById('loading').innerText = "Submitting...";

  try{
    const res = await fetch(WEBAPP_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({action:'checkAnswersAndSave', name, id, answers})
    });
    const data = await res.json();
    alert(data.message);
  }catch(err){ alert("Error submitting answers: "+err.message); }

  document.getElementById('submitBtn').disabled = false;
  document.getElementById('loading').innerText = "";
}
</script>
</body>
</html>
